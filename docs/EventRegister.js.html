<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: EventRegister.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: EventRegister.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from "react";
import { graphql } from "react-apollo";

import moment from 'moment';

import QueryGetEvent from "../GraphQL/QueryGetEvent";
import SubsriptionEventComments from "../GraphQL/SubsriptionEventComments";
import NewRegistry from "./NewRegistry";


/**
 * Component for registering to an event.
 * Makes API call to create new registrations, and displays success message on registration.
 * @component
 */
class EventRegister extends Component {

    subscription;

    componentDidMount() {
        this.subscription = this.props.subscribeToComments();
    }

    componentWillUnmount() {
        this.subscription();
    }

    renderComment = (comment) => {
        return (
            &lt;div className="comment" key={comment.commentId}>
                &lt;div className="avatar">&lt;i className="icon user circular">&lt;/i>&lt;/div>
                &lt;div className="content">
                    &lt;div className="text">
                        {comment.content}
                    &lt;/div>
                    &lt;div className="metadata">{moment(comment.createdAt).format('LL, LT')}&lt;/div>
                &lt;/div>
            &lt;/div>
        );
    }

    render() {
        const { comments: { items }, eventId } = this.props;

        return (
            &lt;div className="ui items">
                &lt;div className="item">
                    &lt;div className="ui comments">
                        &lt;NewRegistry eventId={eventId} />
                    &lt;/div>
                &lt;/div>
            &lt;/div>
        );
    }

}

const EventRegisterWithData = graphql(
    QueryGetEvent,
    {
        options: ({ eventId: id }) => ({
            fetchPolicy: 'cache-first',
            variables: { id }
        }),
        props: props => ({
            comments: props.data.getEvent ? props.data.getEvent.comments : { items: [] },
            subscribeToComments: () => props.data.subscribeToMore({
                document: SubsriptionEventComments,
                variables: {
                    eventId: props.ownProps.eventId,
                },
                updateQuery: (prev, { subscriptionData: { data: { subscribeToEventComments } } }) => {
                    const res = {
                        ...prev,
                        getEvent: {
                            ...prev.getEvent,
                            comments: {
                                __typename: 'CommentConnections',
                                ...prev.getEvent.comments,
                                items: [
                                    ...prev.getEvent.comments.items.filter(c => c.commentId !== subscribeToEventComments.commentId),
                                    subscribeToEventComments,
                                ]
                            }
                        }
                    };

                    return res;
                }
            })
        }),
    },
)(EventRegister);

export default EventRegisterWithData;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="DateTimePickerCustomInput.html">DateTimePickerCustomInput</a></li><li><a href="EventRegister.html">EventRegister</a></li><li><a href="module.exports.html">exports</a></li><li><a href="MyEvent.html">MyEvent</a></li><li><a href="NavBar.html">NavBar</a></li><li><a href="ProjectCard.html">ProjectCard</a></li><li><a href="ProjectsBar.html">ProjectsBar</a></li><li><a href="SearchBar.html">SearchBar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sun May 16 2021 06:38:39 GMT+0300 (GMT+03:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
